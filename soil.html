<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Soil Data & Crop Recommendation</title>
<link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">
<script>
function showAuto() {
    document.getElementById('auto-soil').style.display = 'block';
    document.getElementById('manual-soil').style.display = 'none';
}
function showManual() {
    document.getElementById('auto-soil').style.display = 'none';
    document.getElementById('manual-soil').style.display = 'block';
}

async function fetchSoil() {
    if (!navigator.geolocation) {
        alert("Geolocation is not supported by your browser");
        return;
    }

    navigator.geolocation.getCurrentPosition(async (position) => {
        const lat = position.coords.latitude;
        const lon = position.coords.longitude;

        const res = await fetch('/fetch-soil', {
            method: 'POST',
            headers: {'Content-Type': 'application/json'},
            body: JSON.stringify({lat, lon})
        });
        const data = await res.json();

        if(data.error){
            document.getElementById('soil-result').innerHTML = `<p class="text-danger">${data.error}</p>`;
            return;
        }

        document.getElementById('soil-result').innerHTML = `
            <h5>Soil Data (0-5cm)</h5>
            <p>Nitrogen (N): ${data.N}</p>
            <p>Phosphorus (P): ${data.P}</p>
            <p>Potassium (K): ${data.K}</p>
            <p>pH: ${data.pH}</p>
            <a href="/manual-soil" class="btn btn-success mt-2">Get Crop Recommendation</a>
        `;
    });
}
</script>
</head>
<body class="p-4">
<div class="container">
    <h2 class="mb-4">Soil Data & Crop Recommendation</h2>
    <div class="mb-3">
        <button class="btn btn-primary me-2" onclick="showAuto()">Auto Detect Soil</button>
        <button class="btn btn-secondary" onclick="showManual()">Manual Entry</button>
    </div>

    <div id="auto-soil" style="display:none;">
        <button class="btn btn-success" onclick="fetchSoil()">Fetch Soil Data from My Location</button>
        <div id="soil-result" class="mt-3"></div>
    </div>

    <div id="manual-soil" style="display:none;">
        <form method="POST" action="/manual-soil">
            <div class="mb-2">
                <label>Nitrogen (N)</label>
                <input type="number" step="0.1" name="N" class="form-control" required>
            </div>
            <div class="mb-2">
                <label>Phosphorus (P)</label>
                <input type="number" step="0.1" name="P" class="form-control" required>
            </div>
            <div class="mb-2">
                <label>Potassium (K)</label>
                <input type="number" step="0.1" name="K" class="form-control" required>
            </div>
            <div class="mb-2">
                <label>pH</label>
                <input type="number" step="0.1" name="pH" class="form-control" required>
            </div>
            <button type="submit" class="btn btn-primary mt-2">Get Crop Recommendation</button>
        </form>
    </div>
</div>
</body>
</html>
